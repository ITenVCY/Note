之前下载的在自己的云服务器上编译好了以后发现和公司的运行系统位数对不上. 导致了.so库引用的不成功, 所以重新下载重新编译查看是否能正常调用, 报错如下

```bash
/usr/bin/ld: skipping incompatible ./libmodbus.so when searching for -lmodbus
/usr/bin/ld: skipping incompatible /usr/lib/gcc/i686-redhat-linux/4.4.6/../../../libmodbus.so when searching for -lmodbus
/usr/bin/ld: skipping incompatible /usr/lib/libmodbus.so when searching for -lmodbus
/usr/bin/ld: cannot find -lmodbus
collect2: ld returned 1 exit status
```

```bash
#查看当前库的位数 -> 64 位
[root@hncuc Test]# readelf -h libmodbus.so
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Shared object file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x2970
  Start of program headers:          64 (bytes into file)
  Start of section headers:          164712 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         7
  Size of section headers:           64 (bytes)
  Number of section headers:         36
  Section header string table index: 35


#查看当前系统的位数 -> 32
[root@hncuc Test]# getconf LONG_BIT
32

```



 所以从头再来一次, 把从Git上下载的libmodbus上的文件复制到系统里面重新编译, 但是首先要检查系统是否具有几个编译库

```bash
find / -name "automake"
find / -name "autoconf"
find / -name "libtool"
#这三个编译所需的工具是编译libmodbus的必需品
```

具备了编译环境现在准备下载Git上的代码部分

```bash
# 因为系统没有联网, 所以下载我是通过自己的云服务器git clone下来然后通过FTP工具或者共享文件夹映射到系统中
git clone git://github.com/stephane/libmodbus
```

下面开始编译

```bash
#上一步我们已经移植文件到系统下
#在libmodbus同级目录创建install, 以后的所需的库或者lib文件都是这个文件夹中

[root@hncuc MyTest]# ls
install  libmodbus
[root@hncuc libmodbus]# ./autogen.sh 
libtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `build-aux'.
libtoolize: linking file `build-aux/ltmain.sh'
libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.
libtoolize: linking file `m4/libtool.m4'
libtoolize: linking file `m4/ltoptions.m4'
libtoolize: linking file `m4/ltsugar.m4'
libtoolize: linking file `m4/ltversion.m4'
libtoolize: linking file `m4/lt~obsolete.m4'
configure.ac:56: installing `build-aux/config.guess'
configure.ac:56: installing `build-aux/config.sub'
configure.ac:32: installing `build-aux/install-sh'
configure.ac:32: installing `build-aux/missing'
src/Makefile.am: installing `build-aux/depcomp'

------------------------------------------------------
Initialized build system. You can now run ./configure 
------------------------------------------------------
#执行完毕以后显示你现在可以运行./configure, 此时就可以执行下一步, 若编译环境缺失先安装必须的三个编译环境

[root@hncuc libmodbus]# ./configure --host=arm-fsl-linux-gnueabi --prefix=~/Desktop/MyTest/install/
configure: error: expected an absolute directory name for --prefix: ~/Desktop/MyTest/install
[root@hncuc libmodbus]# ./configure --host=arm-fsl-linux-gnueabi --prefix=/root/Desktop/MyTest/install/
#执行成功就表示libmodbus的主体文件生成成功 libmodbus文件下是否生成MakeFile文件
[root@hncuc libmodbus]# ls
acinclude.m4        config.h.in      ISSUE_TEMPLATE.md  MIGRATION
aclocal.m4          config.log       libmodbus.pc       NEWS
AUTHORS             config.status    libmodbus.pc.in    README.md
autogen.sh          configure        libtool            src
autom4te.cache      configure.ac     m4                 stamp-h1
build-aux           CONTRIBUTING.md  Makefile           tests
CODE_OF_CONDUCT.md  COPYING.LESSER   Makefile.am
config.h            doc              Makefile.in
[root@hncuc libmodbus]# make install
#code ----生成信息
[root@hncuc MyTest]# cd install/lib/
#文件生成成功
[root@hncuc lib]# ls
libmodbus.la  libmodbus.so  libmodbus.so.5  libmodbus.so.5.1.0  pkgconfig           
[root@hncuc lib]# readelf -h libmodbus.so.5.1.0 
ELF Header:
  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF32
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Shared object file)
  Machine:                           Intel 80386
  Version:                           0x1
  Entry point address:               0x1c50
  Start of program headers:          52 (bytes into file)
  Start of section headers:          90808 (bytes into file)
  Flags:                             0x0
  Size of this header:               52 (bytes)
  Size of program headers:           32 (bytes)
  Number of program headers:         5
  Size of section headers:           40 (bytes)
  Number of section headers:         37
  Section header string table index: 34
#查看上述文件可得当前的版本位数位32位与系统版本一致
```

